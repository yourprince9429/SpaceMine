# SpaceMine 一键部署指南（小白版）

## 📖 前言

这份文档是专门为电脑小白准备的，教你如何用最简单的方式部署 SpaceMine 系统。即使你不懂编程，也能按照这个指南顺利完成部署！

---

## 🎯 什么是部署包？

部署包就是一个已经打包好的"安装包"，里面包含了：
- ✅ 所有程序文件
- ✅ 数据库（MySQL）
- ✅ 所需的工具（Docker镜像）
- ✅ 一键启动脚本

你只需要把部署包放到电脑上，运行一个命令就能完成安装！

---

## 📋 部署前准备

### 1️⃣ 检查你的电脑系统

**支持的系统：**
- Windows 10 或更高版本
- macOS 10.15 或更高版本
- Linux（Ubuntu、CentOS等）

**如何查看系统版本：**

**Windows：**
1. 右键点击"此电脑"或"我的电脑"
2. 选择"属性"
3. 查看"Windows 版本"信息

**macOS：**
1. 点击左上角苹果图标
2. 选择"关于本机"
3. 查看"macOS"版本

### 2️⃣ 安装 Docker 和 Docker Compose

Docker 是一个让程序运行的工具，Docker Compose 是管理多个 Docker 容器的工具，两者都必须安装。

**Windows 安装步骤：**

**步骤1：安装 Docker Desktop**
1. 打开浏览器，访问：https://www.docker.com/products/docker-desktop/
2. 点击"Download for Windows"
3. 下载完成后，双击安装包
4. 按照提示点击"Next"或"确定"完成安装
5. 安装完成后，重启电脑
6. 重启后，在桌面找到"Docker Desktop"图标，双击打开
7. 等待 Docker 启动（看到小鲸鱼图标在任务栏显示就表示启动成功）

**步骤2：安装 Git for Windows（必需）**
1. 打开浏览器，访问：https://gitforwindows.org/
2. 点击"Download"按钮下载最新版本
3. 下载完成后，双击安装包
4. 按照提示点击"Next"，使用默认选项即可
5. 安装完成后，在开始菜单中找到"Git Bash"

**💡 提示：** 
- Docker Desktop 已经包含了 Docker Compose，无需单独安装！
- Git for Windows 提供了 bash 环境，是运行部署脚本的必需工具！

**macOS 安装步骤：**

1. 打开浏览器，访问：https://www.docker.com/products/docker-desktop/
2. 点击"Download for Mac"
3. 选择适合你芯片的版本（Intel芯片选"Mac with Intel chip"，苹果M1/M2选"Mac with Apple chip"）
4. 下载完成后，双击安装包
5. 将 Docker 拖到"应用程序"文件夹
6. 打开"应用程序"，找到"Docker"，双击打开
7. 按照提示完成设置
8. 等待 Docker 启动（看到顶部菜单栏出现小鲸鱼图标就表示启动成功）

**💡 提示：** Docker Desktop 已经包含了 Docker Compose，无需单独安装！

**Linux 安装步骤：**

**步骤1：安装 Docker**
```bash
# 打开终端，输入以下命令
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

**步骤2：安装 Docker Compose**
```bash
# 下载最新版本的 Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 给 Docker Compose 添加执行权限
sudo chmod +x /usr/local/bin/docker-compose

# 验证安装
docker-compose --version
```

### 3️⃣ 验证 Docker 和 Docker Compose 是否安装成功

打开终端（命令行窗口），输入以下命令：

**验证 Docker：**
```bash
docker --version
```

**验证 Docker Compose：**
```bash
docker-compose --version
```

如果看到类似以下输出，说明安装成功！

```
Docker version 20.10.24, build 297e128
Docker Compose version v2.17.3
```

---

## 📦 获取部署包

部署包文件名通常是这样的格式：`SpaceMine_20250130_143022.tar.gz`

**获取方式：**
1. 从开发人员那里获取部署包文件
2. 或者在项目目录运行构建脚本生成部署包

---

## 🚀 开始部署

### 第一步：解压部署包

**Windows：**
1. 找到部署包文件（`SpaceMine_*.tar.gz`）
2. 右键点击文件
3. 选择"解压到当前文件夹"或"全部解压"
4. 等待解压完成

**macOS：**
1. 双击部署包文件，系统会自动解压
2. 解压后会得到一个文件夹，名称类似 `SpaceMine_20250130_143022`

**Linux：**
```bash
# 打开终端，进入部署包所在目录
tar -xzf SpaceMine_*.tar.gz
# 进入解压后的目录
cd SpaceMine_*
```

### 第二步：配置环境变量

1. 进入解压后的文件夹
2. 找到名为 `.env` 的文件（注意前面有个点）
3. 用记事本或文本编辑器打开它
4. 修改以下内容：

```env
# 密钥设置（建议修改成一个随机字符串）
SECRET_KEY=your-production-secret-key-change-this

# 数据库密码（建议修改成你自己的密码）
MYSQL_ROOT_PASSWORD=hang113209
MYSQL_USER=spacemine_user
MYSQL_PASSWORD=spacemine_password

# 数据库名称（一般不需要修改）
MYSQL_DATABASE=SpaceMine
```

**💡 提示：**
- `SECRET_KEY` 可以改成任意随机字符串，比如：`MySecretKey2025`
- `MYSQL_ROOT_PASSWORD` 是数据库管理员密码，建议改成你自己的密码
- 修改后保存文件

### 第三步：启动服务

**Windows：**
1. 在文件夹中找到 `deploy.sh` 文件
2. 右键点击文件
3. 选择"打开方式" → "Git Bash"（如果安装了Git）
4. 或者在 Git Bash 终端中，进入文件夹，输入：
   ```bash
   bash deploy.sh
   ```

**macOS：**
1. 打开"终端"
2. 输入 `cd `（注意 cd 后面有个空格）
3. 把解压后的文件夹拖到终端窗口中，按回车
4. 输入以下命令：
   ```bash
   bash deploy.sh
   ```

**Linux：**
```bash
bash deploy.sh
```

### 第四步：等待部署完成

部署脚本会自动执行以下操作：
- 📦 加载 Docker 镜像
- 🚀 启动 MySQL 数据库
- 🗄️ 创建数据库表结构
- 👥 初始化角色权限
- 👤 创建管理员账号
- ⚙️ 初始化系统配置
- ⛏️ 初始化挖矿规则

这个过程大约需要 2-5 分钟，请耐心等待。

看到以下信息表示部署成功：
```
=========================================
✅ SpaceMine 部署成功！
=========================================

📊 访问地址:
   - Web服务: http://localhost:5001
   - MySQL:   localhost:3306
```

---

## 🎉 部署成功！

### 访问系统

打开浏览器，在地址栏输入：
```
http://localhost:5001
```

按回车，就能看到 SpaceMine 的登录界面了！

### 默认管理员账号

- 用户名：`admin`
- 密码：`admin123`

**⚠️ 重要提示：首次登录后请立即修改密码！**

---

## 🛠️ 常用操作命令

### 查看服务运行状态

```bash
docker-compose ps
```

### 查看日志（查看系统运行情况）

```bash
docker-compose logs -f
```

按 `Ctrl + C` 可以退出日志查看

### 停止服务

```bash
bash stop.sh
```

### 重启服务

```bash
bash restart.sh
```

### 完全删除服务（包括数据）

```bash
docker-compose down -v
```

⚠️ 这个命令会删除所有数据，请谨慎使用！

---

## ❓ 常见问题解答

### Q1: 运行 `bash deploy.sh` 时提示"权限被拒绝"

**解决方法：**

Windows：使用 Git Bash 运行

macOS/Linux：
```bash
chmod +x deploy.sh
bash deploy.sh
```

### Q2: 提示"Docker 未运行"

**解决方法：**
1. 检查 Docker Desktop 是否已启动
2. Windows：查看任务栏是否有小鲸鱼图标
3. macOS：查看顶部菜单栏是否有小鲸鱼图标
4. 如果没有启动，打开 Docker Desktop 等待启动完成

### Q3: 提示"docker-compose: command not found"

**解决方法：**

**Windows/macOS：**
- 确保 Docker Desktop 已启动
- Docker Desktop 包含了 Docker Compose，无需单独安装

**Linux：**
重新安装 Docker Compose：
```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
docker-compose --version
```

### Q4: 端口被占用（提示端口 5001 或 3306 已被使用）

**解决方法：**

1. 检查是否有其他程序占用了这些端口
2. 修改 `.env` 文件中的端口号：

```env
# 修改 Web 端口（默认 5001）
WEB_PORT=5002

# 修改 MySQL 端口（默认 3306）
MYSQL_PORT=3307
```

3. 保存后重新运行 `bash deploy.sh`

### Q5: 数据库连接失败

**解决方法：**

1. 检查 `.env` 文件中的数据库配置是否正确
2. 确认 MySQL 容器是否正常运行：
   ```bash
   docker-compose ps
   ```
3. 查看 MySQL 日志：
   ```bash
   docker-compose logs mysql
   ```

### Q6: 部署过程中卡住不动

**解决方法：**

1. 按 `Ctrl + C` 停止当前命令
2. 查看服务状态：
   ```bash
   docker-compose ps
   ```
3. 如果有服务正在运行，先停止：
   ```bash
   docker-compose down
   ```
4. 重新运行部署脚本：
   ```bash
   bash deploy.sh
   ```

### Q7: 忘记管理员密码怎么办？

**解决方法：**

1. 进入 Docker 容器：
   ```bash
   docker-compose exec web bash
   ```
2. 运行重置脚本：
   ```bash
   python data/init_admin_user.pyc
   ```
3. 退出容器：
   ```bash
   exit
   ```
4. 使用默认账号密码登录：`admin` / `admin123`

### Q8: 如何备份数据？

**解决方法：**

```bash
# 备份数据库
docker-compose exec mysql mysqldump -u root -p${MYSQL_ROOT_PASSWORD} ${MYSQL_DATABASE} > backup_$(date +%Y%m%d).sql

# 恢复数据库
docker-compose exec -T mysql mysql -u root -p${MYSQL_ROOT_PASSWORD} ${MYSQL_DATABASE} < backup_20250130.sql
```

### Q9: 如何更新系统？

**解决方法：**

1. 停止服务：
   ```bash
   docker-compose down
   ```
2. 获取新的部署包
3. 解压新的部署包
4. 保留 `.env` 文件（你的配置）
5. 运行新的部署脚本：
   ```bash
   bash deploy.sh
   ```

---

## 📞 获取帮助

如果遇到以上无法解决的问题：

1. 查看日志文件：
   ```bash
   docker-compose logs > error.log
   ```
2. 将 `error.log` 文件发送给技术支持人员
3. 或联系开发团队获取帮助

---

## 🔐 安全建议

1. **修改默认密码**：首次登录后立即修改管理员密码
2. **修改 SECRET_KEY**：在 `.env` 文件中设置一个复杂的密钥
3. **定期备份数据**：建议每天备份一次数据库
4. **不要暴露端口**：如果部署在公网，建议使用防火墙限制访问
5. **更新系统**：定期获取新的部署包进行更新

---

## 📝 附录：端口说明

| 服务 | 默认端口 | 用途 |
|------|---------|------|
| Web 服务 | 5001 | 访问 SpaceMine 系统 |
| MySQL | 3306 | 数据库服务 |

---

## 🎓 术语解释

| 术语 | 解释 |
|------|------|
| Docker | 一个让程序运行的工具，就像一个虚拟机 |
| 镜像 | 程序的"安装包"，包含运行程序所需的一切 |
| 容器 | 运行中的程序实例 |
| 端口 | 程序与外界通信的"门"，每个程序占用一个端口 |
| 数据库 | 存储数据的地方，就像一个电子表格 |
| 终端 | 命令行窗口，用来输入命令 |

---

**祝你部署顺利！如有问题，请参考"常见问题解答"部分。**
